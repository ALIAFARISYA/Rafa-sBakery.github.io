<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rafa's Bakery - Place Your Order</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>
</head>
<body>
    <div class="containers">
        <headers>
            <div class="logos">Rafa's Bakery</div>
            <p class="tagline">Complete your order - Just a few steps away from deliciousness!</p>
            <div class="malaysia-notice">
                <i class="fas fa-info-circle"></i> We currently deliver only within Malaysia
            </div>
        </headers>
        
        <!-- Checkout Progress -->
        <div class="checkout-progress">
            <div class="progress-step">
                <div class="step-circle active">1</div>
                <div class="step-label active">Contact Info</div>
            </div>
            <div class="progress-step">
                <div class="step-circle active">2</div>
                <div class="step-label active">Shipping</div>
            </div>
            <div class="progress-step">
                <div class="step-circle active">3</div>
                <div class="step-label active">Review</div>
            </div>
            <div class="progress-step">
                <div class="step-circle">4</div>
                <div class="step-label">Payment</div>
            </div>
        </div>
        
        <div class="checkout-container">
            <!-- 1. Contact Information -->
            <div class="checkout-section">
                <h2 class="section-title"><i class="fas fa-user"></i> Contact Information</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="first-name" class="required">First Name</label>
                        <input type="text" id="first-name" placeholder="Enter your first name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="last-name" class="required">Last Name</label>
                        <input type="text" id="last-name" placeholder="Enter your last name" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="email" class="required">Email Address</label>
                        <input type="email" id="email" placeholder="Enter your email address" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone" class="required">Phone Number</label>
                        <input type="tel" id="phone" placeholder="Enter your phone number" required>
                    </div>
                </div>
            </div>
            
            <!-- 2. Shipping Information -->
            <div class="checkout-section">
                <h2 class="section-title"><i class="fas fa-truck"></i> Shipping Information</h2>
                
                <div class="form-group">
                    <label for="street-address" class="required">Street Address</label>
                        <input type="text" id="street-address" placeholder="Enter your street address" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="town-city" class="required">Town / City</label>
                        <input type="text" id="town-city" placeholder="Enter your town/city" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="postcode" class="required">Postcode</label>
                        <input type="text" id="postcode" placeholder="Enter your postcode" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="state" class="required">State</label>
                        <select id="state" required>
                            <option value="">Select your state</option>
                            <option value="johor">Johor</option>
                            <option value="kedah">Kedah</option>
                            <option value="kelantan">Kelantan</option>
                            <option value="kl">Kuala Lumpur</option>
                            <option value="labuan">Labuan</option>
                            <option value="melaka">Melaka</option>
                            <option value="negeri-sembilan">Negeri Sembilan</option>
                            <option value="pahang">Pahang</option>
                            <option value="penang">Penang</option>
                            <option value="perak">Perak</option>
                            <option value="perlis">Perlis</option>
                            <option value="putrajaya">Putrajaya</option>
                            <option value="sabah">Sabah</option>
                            <option value="sarawak">Sarawak</option>
                            <option value="selangor">Selangor</option>
                            <option value="terengganu">Terengganu</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="country" class="required">Country</label>
                        <input type="text" id="country" value="Malaysia" readonly style="background-color: #f0f0f0;">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Shipping Method</label>
                    <div class="radio-group">
                        <div class="radio-option selected" id="self-pickup">
                            <input type="radio" id="pickup" name="shipping" value="pickup" checked>
                            <label for="pickup">Self Pickup</label>
                            <span style="margin-left: auto; font-weight: 700; color: #27ae60;">Free</span>
                        </div>
                        
                        <div class="radio-option" id="delivery">
                            <input type="radio" id="delivery-option" name="shipping" value="delivery">
                            <label for="delivery-option">Delivery</label>
                            <span style="margin-left: auto; font-weight: 700;">RM 30.00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 3. Payment Method -->
<div class="checkout-section">
    <h2 class="section-title"><i class="fas fa-credit-card"></i> Payment Method</h2>
    
    <div class="payment-options">
        <div class="payment-option selected" id="paypal-option">
            <input type="radio" id="paypal" name="payment" value="paypal" checked>
            <i class="fab fa-cc-paypal"></i>
            <label for="paypal">PayPal</label>
        </div>
        
        <div class="payment-option" id="creditcard-option">
            <input type="radio" id="creditcard" name="payment" value="creditcard">
            <i class="far fa-credit-card"></i>
            <label for="creditcard">Credit/Debit Card</label>
        </div>
        
        <div class="payment-option" id="onlinebanking-option">
            <input type="radio" id="onlinebanking" name="payment" value="onlinebanking">
            <i class="fas fa-university"></i>
            <label for="onlinebanking">Online Banking (FPX)</label>
        </div>
        
        <div class="payment-option" id="ewallet-option">
            <input type="radio" id="ewallet" name="payment" value="ewallet">
            <i class="fas fa-mobile-alt"></i>
            <label for="ewallet">eWallet</label>
        </div>
    </div>
    
    <div class="form-group" style="margin-top: 25px;">
        <div class="checkbox-group">
            <input type="checkbox" id="same-as-shipping" checked>
            <label for="same-as-shipping">Billing address same as shipping address</label>
        </div>
    </div>
    
    <div id="billing-details" style="display: none; margin-top: 20px;">
        <h3 style="font-size: 1.1rem; color: #5c3d2e; margin-bottom: 15px;">Billing Address</h3>
        <div class="form-group">
            <label for="billing-street" class="required">Billing Street Address</label>
            <input type="text" id="billing-street" placeholder="Enter billing street address">
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="billing-city" class="required">Billing Town / City</label>
                <input type="text" id="billing-city" placeholder="Enter billing town/city">
            </div>
            
            <div class="form-group">
                <label for="billing-postcode" class="required">Billing Postcode</label>
                <input type="text" id="billing-postcode" placeholder="Enter billing postcode">
            </div>
        </div>
        
        <div class="form-group">
            <label for="billing-state" class="required">Billing State</label>
            <select id="billing-state">
                <option value="">Select billing state</option>
                <option value="johor">Johor</option>
                <option value="kedah">Kedah</option>
                <option value="kelantan">Kelantan</option>
                <option value="kl">Kuala Lumpur</option>
                <option value="labuan">Labuan</option>
                <option value="melaka">Melaka</option>
                <option value="negeri-sembilan">Negeri Sembilan</option>
                <option value="pahang">Pahang</option>
                <option value="penang">Penang</option>
                <option value="perak">Perak</option>
                <option value="perlis">Perlis</option>
                <option value="putrajaya">Putrajaya</option>
                <option value="sabah">Sabah</option>
                <option value="sarawak">Sarawak</option>
                <option value="selangor">Selangor</option>
                <option value="terengganu">Terengganu</option>
            </select>
        </div>
    </div>
</div>
            
            <!-- 4. Order Summary -->
            <div class="checkout-section">
                <h2 class="section-title"><i class="fas fa-shopping-cart"></i> Order Summary</h2>
                
                <!-- ENHANCED Order Summary -->
                <div class="order-summary-enhanced">
                    <div class="order-summary-title">
                        <span><i class="fas fa-receipt"></i> Your Cart Items</span>
                        <span class="summary-update-time" id="summaryUpdateTime">Loading...</span>
                    </div>
                    
                    <!-- Cart Items Container -->
                    <div id="cartItemsContainer">
                        <div class="empty-cart-message">
                            <i class="fas fa-shopping-cart"></i>
                            <p>Your cart is empty</p>
                            <p style="font-size: 0.9rem; margin-top: 10px;">Add items from the menu to continue</p>
                        </div>
                    </div>
                    
                    <!-- Subtotal -->
                    <div class="summary-item" id="subtotalSummaryItem" style="display: none;">
                        <div class="summary-label">
                            <span>Subtotal</span>
                            <div class="summary-details" id="itemCountDetails">0 items</div>
                        </div>
                        <div class="summary-price" id="subtotalSummaryPrice">RM 0.00</div>
                    </div>
                    
                    <!-- Delivery Fee -->
                    <div class="summary-item" id="deliverySummaryItem" style="display: none;">
                        <div class="summary-label">
                            <span>Delivery Fee</span>
                            <div class="summary-details" id="deliveryDetails">Standard delivery</div>
                        </div>
                        <div class="summary-price" id="deliverySummaryPrice">RM 30.00</div>
                    </div>
                    
                    <!-- Discount Message -->
                    <div class="discount-message-enhanced" id="discountMessageEnhanced" style="display: none;">
                        <i class="fas fa-tag"></i>
                        <span id="discountMessageText"></span>
                    </div>
                    
                    <!-- Discount Applied -->
                    <div class="summary-item" id="discountSummaryItem" style="display: none;">
                        <div class="summary-label discount-item-enhanced">
                            <span>Discount Applied</span>
                            <div class="summary-details" id="discountTypeText"></div>
                        </div>
                        <div class="summary-price discount-item-enhanced" id="discountSummaryValue">-RM 0.00</div>
                    </div>
                    
                    <!-- Total -->
                    <div class="summary-total">
                        <div class="total-row">
                            <span>Total Amount</span>
                            <span class="total-amount" id="totalSummaryPrice">RM 0.00</span>
                        </div>
                        <div class="summary-note">
                            <i class="fas fa-info-circle"></i> 
                            Price includes tax. Free pickup available at our bakery.
                        </div>
                    </div>
                    
                    <!-- Discount Code Input -->
                    <div class="form-group" style="margin-top: 20px;">
                        <label for="discount">Discount Code (Optional)</label>
                        <div class="discount-section">
                            <input type="text" id="discount" placeholder="Enter discount code">
                            <button class="apply-btn" id="apply-discount">Apply</button>
                        </div>
                        <div class="discount-applied" id="discount-message"></div>
                    </div>
                </div>
            </div>
            
            <!-- 5. Delivery/Pickup Schedule -->
            <div class="checkout-section">
                <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Delivery/Pickup Schedule</h2>
                
                <div class="date-time-section">
                    <div class="form-group">
                        <label for="delivery-date" class="required">Select Date</label>
                        <input type="date" id="delivery-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="delivery-time" class="required">Select Time</label>
                        <select id="delivery-time" required>
                            <option value="">Select a time</option>
                            <option value="09:00">9:00 AM - 10:00 AM</option>
                            <option value="10:00">10:00 AM - 11:00 AM</option>
                            <option value="11:00">11:00 AM - 12:00 PM</option>
                            <option value="12:00">12:00 PM - 1:00 PM</option>
                            <option value="13:00">1:00 PM - 2:00 PM</option>
                            <option value="14:00">2:00 PM - 3:00 PM</option>
                            <option value="15:00">3:00 PM - 4:00 PM</option>
                            <option value="16:00">4:00 PM - 5:00 PM</option>
                            <option value="17:00">5:00 PM - 6:00 PM</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="special-instructions">Special Instructions (Optional)</label>
                    <textarea id="special-instructions" rows="3" placeholder="Add any special instructions for delivery or preparation..."></textarea>
                </div>
            </div>
            
            <!-- Place Order Button -->
            <button class="place-order-btn" id="place-order">
                <i class="fas fa-lock"></i> Place Order & Proceed to Payment
            </button>
            
            <div class="terms-section">
                <p>By placing your order, you agree to Rafa's Bakery's <a href="#">Terms & Conditions</a> and <a href="#">Privacy Policy</a></p>
            </div>
        </div>
    </div>
    <script>
        // ==================== CART FUNCTIONS ====================
        
        // Get cart data from localStorage
        function getCartData() {
            try {
                const cartJson = localStorage.getItem('rafasBakeryCart');
                return cartJson ? JSON.parse(cartJson) : [];
            } catch (error) {
                console.error('Error reading cart data:', error);
                return [];
            }
        }
        
        // Display cart items in order summary
        function displayCartItems() {
            const cart = getCartData();
            const container = document.getElementById('cartItemsContainer');
            const itemCountElement = document.getElementById('itemCountDetails');
            const subtotalItem = document.getElementById('subtotalSummaryItem');
            
            if (!container) return;
            
            // Clear container
            container.innerHTML = '';
            
            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="empty-cart-message">
                        <i class="fas fa-shopping-cart"></i>
                        <p>Your cart is empty</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Add items from the menu to continue</p>
                    </div>
                `;
                subtotalItem.style.display = 'none';
                return;
            }
            
            // Calculate subtotal
            let subtotal = 0;
            
            // Display each cart item
            cart.forEach((item, index) => {
            const itemQty = item.quantity || 1;
            const itemTotal = item.price * itemQty;
            subtotal += itemTotal;

            const itemElement = document.createElement('div');
                itemElement.className = 'summary-item';

                itemElement.innerHTML = `
            <div class="product-details-enhanced">
                <div class="product-name-enhanced">
                    ${item.name}
                </div>

                <div class="summary-details">
                    Size: ${item.size} • Qty: ${itemQty}
                </div>
            </div>

            <div class="summary-price">
                RM ${itemTotal.toFixed(2)}
            </div>
    `;

        

                
                // Format message preview
                let messagePreview = '';
                if (item.message && item.message.trim() !== '') {
                    const shortMessage = item.message.length > 50 ? 
                        item.message.substring(0, 50) + '...' : item.message;
                    messagePreview = `<div class="product-description-enhanced">Message: "${shortMessage}"</div>`;
                }
                
                // Format details
                let details = '';
                if (item.greetingCard) {
                    details += 'With greeting card • ';
                }
                details += `${item.size} size`;
                
                itemElement.innerHTML = `
                    <div class="product-details-enhanced">
                        <div class="product-name-enhanced">${item.name}</div>
                        ${messagePreview}
                        <div class="summary-details">
                            ${details}
                        </div>
                    </div>
                    <div class="summary-price">RM ${item.price.toFixed(2)}</div>
                `;
                container.appendChild(itemElement);
            });
            
            // Update item count and subtotal
            itemCountElement.textContent = `${cart.length} ${cart.length === 1 ? 'item' : 'items'}`;
            document.getElementById('subtotalSummaryPrice').textContent = `RM ${subtotal.toFixed(2)}`;
            subtotalItem.style.display = 'flex';
        }
        
        // Calculate cart totals
        function calculateCartTotals() {
            const cart = getCartData();
            let subtotal = 0;
            
            // Calculate subtotal from all cart items
            cart.forEach(item => {
                const qty = item.quantity || 1;
                subtotal += item.price * qty;
            });

            
            // Check if delivery is selected
            const deliveryFee = document.getElementById('delivery-option')?.checked ? DELIVERY_FEE : 0;
            
            // Calculate discount
            let discount = 0;
            if (currentDiscount > 0) {
                if (discountType === 'percentage') {
                    discount = (subtotal + deliveryFee) * (currentDiscount / 100);
                } else {
                    discount = currentDiscount;
                }
            }
            
            // Calculate total
            const total = subtotal + deliveryFee - discount;
            
            return { subtotal, deliveryFee, discount, total, cart };
        }
        
        // ==================== CHECKOUT FUNCTIONS ====================
        
        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('delivery-date').min = today;
        
        // Set a default date (tomorrow)
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        const tomorrowFormatted = tomorrow.toISOString().split('T')[0];
        document.getElementById('delivery-date').value = tomorrowFormatted;
        
        // Price variables
        const DELIVERY_FEE = 30.00;
        let currentDiscount = 0;
        let discountType = ''; // 'percentage' or 'fixed'
        let lastUpdateTime = new Date();
        
        // DOM Elements
        const selfPickupOption = document.getElementById('self-pickup');
        const deliveryOption = document.getElementById('delivery');
        const totalSummaryPriceElement = document.getElementById('totalSummaryPrice');
        const deliverySummaryItem = document.getElementById('deliverySummaryItem');
        const deliverySummaryPriceElement = document.getElementById('deliverySummaryPrice');
        const discountSummaryItem = document.getElementById('discountSummaryItem');
        const discountSummaryValueElement = document.getElementById('discountSummaryValue');
        const discountTypeTextElement = document.getElementById('discountTypeText');
        const discountMessageEnhanced = document.getElementById('discountMessageEnhanced');
        const discountMessageTextElement = document.getElementById('discountMessageText');
        const summaryUpdateTimeElement = document.getElementById('summaryUpdateTime');
        
        // Calculate and update total
        function updateTotal() {
            const totals = calculateCartTotals();
            
            // Update delivery fee display
            if (document.getElementById('delivery-option')?.checked) {
                deliverySummaryItem.style.display = 'flex';
                deliverySummaryPriceElement.textContent = `RM ${DELIVERY_FEE.toFixed(2)}`;
            } else {
                deliverySummaryItem.style.display = 'none';
            }
            
            // Calculate discount
            let discount = 0;
            if (currentDiscount > 0) {
                if (discountType === 'percentage') {
                    discount = (totals.subtotal + (document.getElementById('delivery-option')?.checked ? DELIVERY_FEE : 0)) * (currentDiscount / 100);
                    discountTypeTextElement.textContent = `${currentDiscount}% discount applied`;
                } else {
                    discount = currentDiscount;
                    discountTypeTextElement.textContent = `RM ${currentDiscount.toFixed(2)} discount applied`;
                }
                
                // Show discount item
                discountSummaryItem.style.display = 'flex';
                discountSummaryValueElement.textContent = `-RM ${discount.toFixed(2)}`;
            } else {
                discountSummaryItem.style.display = 'none';
            }
            
            // Calculate total
            const total = totals.subtotal + totals.deliveryFee - discount;
            
            // Update total display
            totalSummaryPriceElement.textContent = `RM ${total.toFixed(2)}`;
            
            // Update timestamp
            updateSummaryTime();
            
            // Enable/disable place order button based on cart
            const placeOrderBtn = document.getElementById('place-order');
            if (totals.cart.length === 0) {
                placeOrderBtn.disabled = true;
                placeOrderBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> Add Items to Cart First';
                placeOrderBtn.style.backgroundColor = '#a67c52';
            } else {
                placeOrderBtn.disabled = false;
                placeOrderBtn.innerHTML = '<i class="fas fa-lock"></i> Place Order & Proceed to Payment';
                placeOrderBtn.style.backgroundColor = '#8b4513';
            }
        }
        
        // Update summary timestamp
        function updateSummaryTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            summaryUpdateTimeElement.textContent = `Updated ${timeString}`;
        }
        
        // Shipping option selection
        if (selfPickupOption && deliveryOption) {
            selfPickupOption.addEventListener('click', function() {
                this.classList.add('selected');
                deliveryOption.classList.remove('selected');
                document.getElementById('pickup').checked = true;
                updateTotal();
            });
            
            deliveryOption.addEventListener('click', function() {
                this.classList.add('selected');
                selfPickupOption.classList.remove('selected');
                document.getElementById('delivery-option').checked = true;
                updateTotal();
            });
        }
        
        // Payment option selection
        const paymentOptions = document.querySelectorAll('.payment-option');
        paymentOptions.forEach(option => {
            option.addEventListener('click', function() {
                paymentOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                const radioInput = this.querySelector('input');
                radioInput.checked = true;
        
                // Update payment method description
                updatePaymentDescription();
            });
        });

function updatePaymentDescription() {
    const selectedMethod = document.querySelector('input[name="payment"]:checked').value;
    const methodDescriptions = {
        'paypal': 'Pay with PayPal securely',
        'creditcard': 'Pay with Visa/Mastercard/Amex',
        'onlinebanking': 'Pay via FPX Online Banking',
        'ewallet': 'Pay with eWallet (Boost, Touch n Go, GrabPay)'
    };
    
    // You can add visual feedback if needed
    console.log('Selected payment method:', methodDescriptions[selectedMethod]);
}
        
        // Billing address toggle
        const sameAsShippingCheckbox = document.getElementById('same-as-shipping');
        const billingDetails = document.getElementById('billing-details');
        
        if (sameAsShippingCheckbox && billingDetails) {
            sameAsShippingCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    billingDetails.style.display = 'none';
                } else {
                    billingDetails.style.display = 'block';
                }
            });
        }
        
        // Define valid discount codes
        const discountCodes = {
            'RAFAS10': { type: 'percentage', value: 10, description: '10% off your total order' },
            'WELCOME5': { type: 'fixed', value: 5, description: 'RM 5 off your total order' },
            'BAKERY15': { type: 'percentage', value: 15, description: '15% off your total order (max RM 20)' },
            'SWEETDEAL': { type: 'fixed', value: 12, description: 'RM 12 off orders above RM 100' }
        };
        
        // Apply discount code
        const applyDiscountBtn = document.getElementById('apply-discount');
        const discountInput = document.getElementById('discount');
        
        if (applyDiscountBtn) {
            applyDiscountBtn.addEventListener('click', applyDiscount);
        }
        
        // Also allow pressing Enter in discount field
        if (discountInput) {
            discountInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    applyDiscount();
                }
            });
        }
        
        function applyDiscount() {
            const discountCode = discountInput.value.trim().toUpperCase();
            
            if (!discountCode) {
                showDiscountMessage('Please enter a discount code', false);
                return;
            }
            
            const totals = calculateCartTotals();
            
            if (discountCodes[discountCode]) {
                const discountInfo = discountCodes[discountCode];
                currentDiscount = discountInfo.value;
                discountType = discountInfo.type;
                
                // Apply cap for percentage discount
                if (discountType === 'percentage' && discountCode === 'BAKERY15') {
                    const deliveryFee = document.getElementById('delivery-option')?.checked ? DELIVERY_FEE : 0;
                    const calculatedDiscount = (totals.subtotal + deliveryFee) * (currentDiscount / 100);
                    if (calculatedDiscount > 20) {
                        currentDiscount = 20;
                        discountType = 'fixed';
                    }
                }
                
                showDiscountMessage(`Discount applied: ${discountInfo.description}`, true);
                showEnhancedDiscountMessage(discountInfo.description);
                updateTotal();
            } else {
                currentDiscount = 0;
                showDiscountMessage('Invalid discount code. Please try again.', false);
                hideEnhancedDiscountMessage();
                updateTotal();
            }
        }
        
        function showDiscountMessage(message, isSuccess) {
            const discountMessageElement = document.getElementById('discount-message');
            if (!discountMessageElement) return;
            
            discountMessageElement.textContent = message;
            discountMessageElement.style.color = isSuccess ? '#27ae60' : '#c0392b';
            discountMessageElement.style.display = 'block';
            
            // Clear message after 5 seconds if it's an error
            if (!isSuccess) {
                setTimeout(() => {
                    discountMessageElement.style.display = 'none';
                }, 5000);
            }
        }
        
        function showEnhancedDiscountMessage(message) {
            if (!discountMessageEnhanced || !discountMessageTextElement) return;
            
            discountMessageTextElement.textContent = message;
            discountMessageEnhanced.style.display = 'block';
            discountMessageEnhanced.style.backgroundColor = '#e8f5e9';
            discountMessageEnhanced.style.borderLeftColor = '#27ae60';
        }
        
        function hideEnhancedDiscountMessage() {
            if (!discountMessageEnhanced) return;
            discountMessageEnhanced.style.display = 'none';
        }
        
        // Place order button
        const placeOrderBtn = document.getElementById('place-order');
        if (placeOrderBtn) {
            placeOrderBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                const cart = getCartData();
                if (cart.length === 0) {
                    alert('Your cart is empty. Please add items before placing an order.');
                    return;
                }
                
                // Simple form validation
                const requiredFields = document.querySelectorAll('input[required], select[required]');
                let isValid = true;
                let firstInvalidField = null;
                
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        isValid = false;
                        field.style.borderColor = '#c0392b';
                        
                        if (!firstInvalidField) {
                            firstInvalidField = field;
                        }
                    } else {
                        field.style.borderColor = '#d4a574';
                    }
                });
                
                if (!isValid) {
                    alert('Please fill in all required fields before placing your order.');
                    if (firstInvalidField) {
                        firstInvalidField.focus();
                    }
                    return;
                }
                
                // If billing address is different, validate those fields too
                if (!sameAsShippingCheckbox.checked) {
                    const billingRequiredFields = document.querySelectorAll('#billing-details input[required], #billing-details select[required]');
                    let billingValid = true;
                    
                    billingRequiredFields.forEach(field => {
                        if (!field.value.trim()) {
                            billingValid = false;
                            field.style.borderColor = '#c0392b';
                        } else {
                            field.style.borderColor = '#d4a574';
                        }
                    });
                    
                    if (!billingValid) {
                        alert('Please fill in all billing address fields.');
                        return;
                    }
                }
                
                // Validate date
                const selectedDate = new Date(document.getElementById('delivery-date').value);
                const todayDate = new Date();
                todayDate.setHours(0, 0, 0, 0);
                
                if (selectedDate < todayDate) {
                    alert('Please select a future date for delivery/pickup.');
                    document.getElementById('delivery-date').focus();
                    return;
                }
                
                // Validate phone number format (Malaysian)
                const phoneNumber = document.getElementById('phone').value;
                const phoneRegex = /^(\+?6?01)[0-9]{8,9}$/;
                if (!phoneRegex.test(phoneNumber.replace(/[- ]/g, ''))) {
                    alert('Please enter a valid Malaysian phone number (e.g., 0123456789, +60123456789)');
                    document.getElementById('phone').focus();
                    document.getElementById('phone').style.borderColor = '#c0392b';
                    return;
                }
                
                // Validate postcode (Malaysian postcodes are 5 digits)
                const postcode = document.getElementById('postcode').value;
                const postcodeRegex = /^\d{5}$/;
                if (!postcodeRegex.test(postcode)) {
                    alert('Please enter a valid 5-digit Malaysian postcode.');
                    document.getElementById('postcode').focus();
                    document.getElementById('postcode').style.borderColor = '#c0392b';
                    return;
                }
                
                // If all validations pass
                const totals = calculateCartTotals();
                const orderData = {
                    customerName: `${document.getElementById('first-name').value} ${document.getElementById('last-name').value}`,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    shippingAddress: {
                        street: document.getElementById('street-address').value,
                        city: document.getElementById('town-city').value,
                        state: document.getElementById('state').value,
                        postcode: document.getElementById('postcode').value,
                        country: 'Malaysia'
                    },
                    shippingMethod: document.querySelector('input[name="shipping"]:checked').value,
                    paymentMethod: document.querySelector('input[name="payment"]:checked').value,
                    deliveryDate: document.getElementById('delivery-date').value,
                    deliveryTime: document.getElementById('delivery-time').value,
                    specialInstructions: document.getElementById('special-instructions').value,
                    discountCode: discountInput.value || 'None',
                    discountApplied: currentDiscount > 0 ? `${currentDiscount}${discountType === 'percentage' ? '%' : ' RM'}` : 'None',
                    
                    // Cart information
                    cartItems: cart,
                    itemCount: cart.length,
                    subtotal: `RM ${totals.subtotal.toFixed(2)}`,
                    deliveryFee: document.getElementById('delivery-option')?.checked ? `RM ${DELIVERY_FEE.toFixed(2)}` : 'Free',
                    discount: currentDiscount > 0 ? `-RM ${totals.discount.toFixed(2)}` : 'None',
                    total: totalSummaryPriceElement.textContent
                };
                
                console.log('Order submitted:', orderData);
                            
                /// Determine which payment page to redirect to
                let paymentPage = '';
                switch(orderData.paymentMethod) {
                        case 'paypal':
                            paymentPage = 'payment.html';
                        break;
                        case 'creditcard':
                            paymentPage = 'paymentCard.html';
                        break;
                        case 'onlinebanking':
                            paymentPage = 'payment.html';  
                        break;
                        case 'ewallet':
                            paymentPage = 'payment.html';
                        break;
                            default:
                            paymentPage = 'payment.html';
                }

                // Save order data for payment page
                localStorage.setItem('currentOrder', JSON.stringify(orderData));

                // Redirect to payment page
                setTimeout(() => {
                window.location.href = paymentPage;
                }, 1500);
            });
        }
        
        // ==================== INITIALIZATION ====================
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Display cart items
            displayCartItems();
            
            // Initialize with self-pickup selected
            if (selfPickupOption) {
                selfPickupOption.click();
            }
            
            // Update totals
            updateTotal();
            
            // Initialize summary time
            updateSummaryTime();
            
            // Check cart on page load
            const cart = getCartData();
            if (cart.length === 0) {
                alert('Your cart is empty. You will be redirected to the menu.');
                setTimeout(() => {
                    window.location.href = 'Menu.html';
                }, 2000);
            }
        });
        
        // Listen for storage changes (if cart is updated in another tab)
        window.addEventListener('storage', function(e) {
            if (e.key === 'rafasBakeryCart') {
                displayCartItems();
                updateTotal();
            }
        });

        const accountLink = document.getElementById("accountLink");

            if (localStorage.getItem("isLoggedIn")) {
                accountLink.href = "MyAccount.html";
            }
    </script>
</body>
</html>