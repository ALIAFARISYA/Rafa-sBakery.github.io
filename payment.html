<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPX Payment - Rafa's Bakery</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>
</head>
<bodys>
    <div class="payment-container">
        <!-- Time Remaining -->
        <div class="time-remaining">
            <div class="time-label">Time Remaining</div>
            <div class="time-display" id="timeDisplay">05:00</div>
        </div>
        
        <!-- Payment Details -->
        <div class="payment-details">
            <div class="section-title">Payment details</div>
            
            <table class="details-table">
                <tr>
                    <td class="table-header">Order ID</td>
                    <td class="table-header">Payment ID</td>
                    <td class="table-header">Order Description</td>
                    <td class="table-header">Total</td>
                </tr>
                <tr>
                    <td class="table-value" id="orderId">DF-M834862</td>
                    <td class="table-value" id="paymentId">c4Get3zh197g54</td>
                    <td class="table-value" id="orderDescription">Red Velvet Cake x 1</td>
                    <td class="table-value" id="totalAmount">MYR 137.00</td>
                </tr>
            </table>
        </div>
        
        <!-- Online Banking -->
        <div class="online-banking">
            <div class="section-title">Online Banking</div>
            
            <div class="select-box">
                <div>Select Bank</div>
                <select id="bankSelect">
                    <option value="">-- Select Your Bank --</option>
                    <option value="maybank">Maybank</option>
                    <option value="cimb">CIMB Bank</option>
                    <option value="public">Public Bank</option>
                    <option value="rhb">RHB Bank</option>
                    <option value="hongleong">Hong Leong Bank</option>
                    <option value="ambank">AmBank</option>
                    <option value="uob">UOB Bank</option>
                    <option value="ocbc">OCBC Bank</option>
                    <option value="hsbc">HSBC Bank</option>
                    <option value="standard">Standard Chartered</option>
                    <option value="bankislam">Bank Islam</option>
                    <option value="bankrakyat">Bank Rakyat</option>
                    <option value="affin">Affin Bank</option>
                    <option value="alliance">Alliance Bank</option>
                </select>
            </div>
        </div>
        
        <!-- Terms -->
        <div class="terms">
            By clicking on the "Proceed" button below, you agree to FPX's Terms and Conditions.
        </div>
        
        <!-- Warning -->
        <div class="warning" id="warningMessage">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="warningText">Please select a bank to continue.</span>
        </div>
        
        <!-- Buttons -->
        <div class="buttons">
            <button class="cancel-btn" onclick="cancelPayment()">Cancel</button>
            <button class="proceed-btn" onclick="proceedToBank()">Proceed</button>
        </div>
    </div>
    <script>
        // ==================== VARIABLES ====================
        let timeLeft = 5 * 60; // 5 minutes in seconds
        let timerInterval;
        
        // ==================== TIMER FUNCTIONS ====================
        
        function startTimer() {
            const timeDisplay = document.getElementById('timeDisplay');
            
            function updateTimer() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timeExpired();
                }
                timeLeft--;
            }
            
            updateTimer();
            timerInterval = setInterval(updateTimer, 1000);
        }
        
        function timeExpired() {
            document.getElementById('warningText').textContent = 'Payment time has expired!';
            document.getElementById('warningMessage').style.display = 'block';
            
            // Disable buttons
            document.querySelectorAll('button').forEach(btn => btn.disabled = true);
            
            // Redirect after 3 seconds
            setTimeout(() => {
                window.location.href = 'placeorder.html';
            }, 3000);
        }
        
        // ==================== LOAD ORDER DATA ====================
        
        function loadOrderData() {
            try {
                const orderJson = localStorage.getItem('currentOrder');
                if (orderJson) {
                    const orderData = JSON.parse(orderJson);
                    
                    // Update order description
                    if (orderData.cartItems && orderData.cartItems.length > 0) {

                        if (orderData.cartItems.length === 1) {
                            const item = orderData.cartItems[0];
                            const qty = item.quantity || 1;

                            document.getElementById('orderDescription').textContent =
                                `${item.name} x ${qty}`;

                    } else {
                        // Kira total quantity semua item
                        let totalQty = 0;
                        orderData.cartItems.forEach(item => {
                            totalQty += item.quantity || 1;
                        });

                            document.getElementById('orderDescription').textContent =
                                `${orderData.cartItems.length} items (${totalQty} qty)`;
                        }
                }
                   
                    // Update total amount
                    if (orderData.total) {
                        document.getElementById('totalAmount').textContent = orderData.total;
                    }
                }
            } catch (error) {
                console.error('Error loading order data:', error);
            }
            
            // Generate unique IDs
            document.getElementById('orderId').textContent = `DF-M${Math.floor(100000 + Math.random() * 900000)}`;
            
            // Generate payment ID
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            let paymentId = '';
            for (let i = 0; i < 15; i++) {
                paymentId += chars[Math.floor(Math.random() * chars.length)];
            }
            document.getElementById('paymentId').textContent = paymentId;
        }
        
        // ==================== PAYMENT PROCESSING ====================
        
        function proceedToBank() {
            const bankSelect = document.getElementById('bankSelect');
            const selectedBank = bankSelect.value;
            
            // Check if bank is selected
            if (!selectedBank) {
                document.getElementById('warningText').textContent = 'Please select a bank to continue.';
                document.getElementById('warningMessage').style.display = 'block';
                return;
            }
            
            // Check if cart is empty
            try {
                const orderJson = localStorage.getItem('currentOrder');
                if (orderJson) {
                    const orderData = JSON.parse(orderJson);
                    if (!orderData.cartItems || orderData.cartItems.length === 0) {
                        document.getElementById('warningText').textContent = 'Your cart is empty.';
                        document.getElementById('warningMessage').style.display = 'block';
                        return;
                    }
                }
            } catch (error) {
                console.error('Error checking cart:', error);
            }
            
            // Get bank name
            const bankName = bankSelect.options[bankSelect.selectedIndex].text;
            
            // Disable buttons during processing
            document.querySelectorAll('button').forEach(btn => btn.disabled = true);
            document.querySelector('.proceed-btn').textContent = 'Processing...';
            
            // Save selected bank
            localStorage.setItem('selectedFPXBank', bankName);
            
            // Show processing message
            alert(`Redirecting to ${bankName} payment gateway...`);
            
            // Simulate bank processing
            setTimeout(() => {
                // Save payment success
                localStorage.setItem('paymentSuccess', 'true');
                localStorage.setItem('paymentMethod', 'FPX Online Banking');
                
                // Clear timer
                clearInterval(timerInterval);
                
                // Redirect to success page
                window.location.href = 'paymentGateway.html';
            }, 2000);
        }
        
        function cancelPayment() {
            if (confirm('Cancel payment and return to order page?')) {
                clearInterval(timerInterval);
                window.location.href = 'placeorder.html';
            }
        }
        
        // ==================== INITIALIZATION ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            startTimer();
            loadOrderData();
            
            // Clear warning when bank is selected
            document.getElementById('bankSelect').addEventListener('change', function() {
                if (this.value) {
                    document.getElementById('warningMessage').style.display = 'none';
                }
            });
        });
    </script>
</bodys>
</html>